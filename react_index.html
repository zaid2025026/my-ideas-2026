<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zaid Chat Pro 2026 | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª */
        :root { 
            --gold: #f59e0b; 
            --blue: #3b82f6; 
            --dark-bg: #020617; 
            --glass: rgba(15, 23, 42, 0.9);
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© */
        body, html { 
            height: 100%; 
            margin: 0; 
            background: var(--dark-bg); 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            overflow: hidden; 
            position: fixed;
            width: 100%;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ø­ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
        .glass-panel { 
            background: var(--glass); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        /* ÙÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .msg-me { 
            background: linear-gradient(135deg, #1d4ed8, #2563eb); 
            border-radius: 20px 20px 4px 20px; 
            align-self: flex-end; 
            box-shadow: 0 4px 15px rgba(29, 78, 216, 0.3);
        }
        .msg-other { 
            background: #1e293b; 
            border-radius: 20px 20px 20px 4px; 
            align-self: flex-start; 
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .btn-send { 
            min-width: 60px; 
            height: 60px; 
            background: linear-gradient(135deg, #f59e0b, #b45309); 
            border-radius: 18px;
            display: flex !important;
            align-items: center;
            justify-content: center;
            color: black;
            font-size: 1.2rem;
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.2);
            transition: 0.3s;
        }
        .btn-send:active { transform: scale(0.9); }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .dot { 
            width: 6px; height: 6px; 
            background: var(--gold); 
            border-radius: 50%; 
            display: inline-block; 
            animation: bounce 1.4s infinite ease-in-out both; 
        }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); opacity: 0.3; } 40% { transform: scale(1); opacity: 1; } }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .full-video { 
            position: fixed; inset: 0; z-index: 1000; background: #000; 
            display: flex; flex-direction: column; 
        }
        .my-preview { 
            position: absolute; top: 20px; right: 20px; 
            width: 120px; height: 180px; 
            border-radius: 15px; border: 2px solid var(--gold); 
            z-index: 1001; object-fit: cover; 
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
        .no-scroll::-webkit-scrollbar { display: none; }
        .no-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const config = {
            apiKey: "AIzaSyC9IyERsk-efzo3HVTLBL9xNVTms2LaGGM",
            authDomain: "zaid-chat-3f1e3.firebaseapp.com",
            projectId: "zaid-chat-3f1e3",
            databaseURL: "https://zaid-chat-3f1e3-default-rtdb.firebaseio.com"
        };
        if (!firebase.apps.length) firebase.initializeApp(config);
        const db = firebase.database();
        const alertSnd = new Audio('https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3');

        function ZaidChat() {
            // 2. Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª ÙˆØ§Ù„Ø­Ø§Ù„Ø§Øª (States)
            const params = new URLSearchParams(window.location.search);
            const [room] = React.useState(params.get('room') || 'Ø¹Ø§Ù…Ø©');
            const [user, setUser] = React.useState("");
            const [pass, setPass] = React.useState("");
            const [isAuth, setIsAuth] = React.useState(false);
            const [msgs, setMsgs] = React.useState([]);
            const [input, setInput] = React.useState("");
            const [typer, setTyper] = React.useState("");
            const [myId, setMyId] = React.useState("");
            const [stream, setStream] = React.useState(null);
            const [remote, setRemote] = React.useState(null);
            
            const peerObj = React.useRef(null);
            const scrollRef = React.useRef(null);

            // 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ø§ØªØµØ§Ù„ PeerJS
            React.useEffect(() => {
                const p = new Peer();
                p.on('open', id => setMyId(id));
                p.on('call', call => {
                    if(confirm("ğŸ“² Ø§ØªØµØ§Ù„ ÙˆØ§Ø±Ø¯.. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø±Ø¯ØŸ")) {
                        navigator.mediaDevices.getUserMedia({video: true, audio: true}).then(s => {
                            setStream(s); call.answer(s);
                            call.on('stream', rs => setRemote(rs));
                        });
                    }
                });
                peerObj.current = p;
                return () => p.destroy();
            }, []);

            // 4. Ø§Ù„Ù†Ø²ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
            React.useEffect(() => {
                scrollRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [msgs, typer]);

            // 5. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            const login = async () => {
                if (!user.trim()) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ");
                if (room !== 'Ø¹Ø§Ù…Ø©') {
                    const snap = await db.ref('roomSettings/' + room).once('value');
                    const data = snap.val();
                    if (data && data.password) {
                        if (btoa(pass) !== data.password && pass !== "ZAID_ADMIN_2026") {
                            return alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©!");
                        }
                    } else {
                        if(!pass) return alert("Ù‡Ø°Ù‡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø¹ÙŠÙ† ÙƒÙ„Ù…Ø© Ø³Ø± Ø£ÙˆÙ„Ø§Ù‹");
                        await db.ref('roomSettings/' + room).set({ password: btoa(pass) });
                    }
                }
                setIsAuth(true);
                connectChat();
            };

            // 6. Ø±Ø¨Ø· Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ù€ Firebase
            const connectChat = () => {
                db.ref('chats/' + room).on('child_added', snap => {
                    const m = snap.val();
                    setMsgs(prev => [...prev, m]);
                    if (m.senderId !== myId) alertSnd.play().catch(()=>{});
                });

                db.ref('typing/' + room).on('value', snap => {
                    const entries = Object.entries(snap.val() || {});
                    const active = entries.find(([id, v]) => id !== myId && v.isTyping);
                    setTyper(active ? active[1].name : "");
                });
            };

            // 7. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            const send = () => {
                if(!input.trim()) return;
                const now = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                db.ref('chats/' + room).push({
                    text: input, time: now, senderName: user, senderId: myId
                });
                setInput("");
                updateTyping(false);
            };

            // 8. ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©
            const updateTyping = (st) => {
                db.ref(`typing/${room}/${myId}`).set({ name: user, isTyping: st });
            };

            // 9. ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            if (!isAuth) return (
                <div className="flex items-center justify-center h-screen p-6">
                    <div className="glass-panel p-10 rounded-[40px] w-full max-w-sm text-center">
                        <i className="fas fa-shield-alt text-5xl text-yellow-500 mb-6"></i>
                        <h2 className="text-3xl font-black mb-2">ZAID CHAT</h2>
                        <p className="text-gray-500 text-xs mb-8 uppercase tracking-widest">ØºØ±ÙØ©: {room}</p>
                        <div className="space-y-4 text-right">
                            <label className="text-[10px] mr-2 text-gray-400">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±</label>
                            <input className="w-full p-4 bg-white/5 rounded-2xl border border-white/10 text-white outline-none" 
                                   onChange={e=>setUser(e.target.value)} placeholder="Ù…Ø«Ø§Ù„: Ø²ÙŠØ¯" />
                            {room !== 'Ø¹Ø§Ù…Ø©' && (
                                <>
                                    <label className="text-[10px] mr-2 text-gray-400">ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„ØºØ±ÙØ©</label>
                                    <input className="w-full p-4 bg-white/5 rounded-2xl border border-white/10 text-white outline-none" 
                                           type="password" onChange={e=>setPass(e.target.value)} placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                                </>
                            )}
                            <button onClick={login} className="w-full btn-send !w-full !rounded-2xl font-bold mt-4">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
                        </div>
                    </div>
                </div>
            );

            // 10. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            return (
                <div className="flex flex-col h-screen max-w-lg mx-auto bg-[#020617] relative">
                    
                    {/* Ø§Ù„Ù‡ÙŠØ¯Ø± (Header) */}
                    <div className="glass-panel m-4 p-4 rounded-3xl flex justify-between items-center z-50">
                        <button onClick={()=>window.location.search=""} className="text-red-500 p-2"><i className="fas fa-sign-out-alt text-xl"></i></button>
                        <div className="text-center">
                            <h1 className="font-bold text-sm tracking-tight">ØºØ±ÙØ© {room}</h1>
                            <span className="text-[9px] text-green-500 font-bold uppercase">Online</span>
                        </div>
                        <div className="flex gap-4">
                            <button onClick={async()=>{
                                const target = prompt("Ø£Ø¯Ø®Ù„ Ø¨ØµÙ…Ø© (ID) Ø§Ù„ØµØ¯ÙŠÙ‚:");
                                if(target){
                                    const s = await navigator.mediaDevices.getUserMedia({video:true, audio:true});
                                    setStream(s);
                                    const call = peerObj.current.call(target, s);
                                    call.on('stream', rs => setRemote(rs));
                                }
                            }} className="text-blue-400"><i className="fas fa-video text-xl"></i></button>
                            <button onClick={()=>alert("Ù…Ø¹Ø±ÙÙƒ Ù‡Ùˆ: " + myId)} className="text-yellow-500"><i className="fas fa-fingerprint text-xl"></i></button>
                        </div>
                    </div>

                    {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Messages) */}
                    <div className="flex-1 overflow-y-auto px-5 space-y-6 no-scroll pb-40 flex flex-col pt-4">
                        {msgs.map((m, i) => (
                            <div key={i} className={`max-w-[85%] p-4 ${m.senderId === myId ? "msg-me" : "msg-other"}`}>
                                <p className="text-[9px] font-bold text-yellow-500 mb-1 uppercase">{m.senderName}</p>
                                <p className="text-[15px] leading-relaxed">{m.text}</p>
                                <span className="text-[8px] opacity-40 block mt-2 text-left">{m.time}</span>
                            </div>
                        ))}
                        
                        {/* Ù…Ø¤Ø´Ø± Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø© (Typing Indicator) */}
                        {typer && (
                            <div className="msg-other p-3 flex flex-col gap-1 items-start bg-blue-900/20 border-none">
                                <span className="text-[10px] font-bold text-blue-400">{typer} ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†...</span>
                                <div className="flex gap-1">
                                    <span className="dot"></span><span className="dot"></span><span className="dot"></span>
                                </div>
                            </div>
                        )}
                        <div ref={scrollRef} />
                    </div>

                    {/* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Video Call) */}
                    {(stream || remote) && (
                        <div className="full-video">
                            {remote && <video ref={el=>el&&(el.srcObject=remote)} autoPlay className="w-full h-full object-cover" />}
                            {stream && <video ref={el=>el&&(el.srcObject=stream)} autoPlay muted className="my-preview" />}
                            <div className="absolute bottom-10 left-0 right-0 flex justify-center">
                                <button onClick={()=>{
                                    stream?.getTracks().forEach(t=>t.stop());
                                    setStream(null); setRemote(null);
                                }} className="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center shadow-2xl">
                                    <i className="fas fa-phone-slash text-2xl"></i>
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Input Area) */}
                    <div className="fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black to-transparent">
                        <div className="max-w-lg mx-auto flex gap-3 items-center">
                            <div className="glass-panel flex-1 flex items-center rounded-2xl px-4 border border-white/10">
                                <input 
                                    className="flex-1 bg-transparent py-5 outline-none text-white text-sm" 
                                    placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù‡Ù†Ø§..." 
                                    value={input} 
                                    onChange={(e) => {
                                        setInput(e.target.value);
                                        updateTyping(e.target.value.length > 0);
                                    }} 
                                    onBlur={() => updateTyping(false)}
                                    onKeyPress={(e) => e.key === 'Enter' && send()} 
                                />
                            </div>
                            <button onClick={send} className="btn-send">
                                <i className="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        ReactDOM.createRoot(document.getElementById('root')).render(<ZaidChat />);
    </script>
</body>
</html>