<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zaid Chat Ultimate Pro | 2026</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root { --gold: #f59e0b; --blue: #3b82f6; --dark: #020617; }
        body, html { height: 100%; margin: 0; background: var(--dark); color: white; font-family: system-ui; overflow: hidden; position: fixed; width: 100%; }
        
        .glass-card { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.08); }
        .chat-area { height: calc(100% - 170px); overflow-y: auto; padding: 20px; }
        
        .msg { max-width: 85%; padding: 14px; position: relative; margin-bottom: 5px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .msg-me { background: linear-gradient(135deg, #1d4ed8, #3b82f6); border-radius: 22px 22px 4px 22px; align-self: flex-end; }
        .msg-other { background: #1e293b; border-radius: 22px 22px 22px 4px; align-self: flex-start; border: 1px solid rgba(255,255,255,0.05); }

        .btn-gold { background: linear-gradient(135deg, #f59e0b, #d97706); color: black; font-weight: bold; cursor: pointer; }
        .send-btn { width: 65px; height: 65px; border-radius: 20px; display: flex !important; align-items: center; justify-content: center; background: var(--gold); color: #000; box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4); flex-shrink: 0; }

        .typing-tag { display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: rgba(255,255,255,0.05); border-radius: 15px; width: fit-content; margin-bottom: 10px; }
        .dot { width: 6px; height: 6px; background: var(--gold); border-radius: 50%; animation: blink 1.4s infinite both; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); } 40% { opacity: 1; transform: scale(1.1); } }

        .call-ui { position: fixed; inset: 0; z-index: 9999; background: #000; }
        .remote-v { width: 100%; height: 100%; object-fit: cover; }
        .local-v { position: absolute; top: 30px; right: 20px; width: 110px; height: 160px; border: 2px solid var(--gold); border-radius: 15px; object-fit: cover; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const fbCfg = {
            apiKey: "AIzaSyC9IyERsk-efzo3HVTLBL9xNVTms2LaGGM",
            authDomain: "zaid-chat-3f1e3.firebaseapp.com",
            projectId: "zaid-chat-3f1e3",
            databaseURL: "https://zaid-chat-3f1e3-default-rtdb.firebaseio.com"
        };
        if (!firebase.apps.length) firebase.initializeApp(fbCfg);
        const rtdb = firebase.database();
        const alertSnd = new Audio('https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3');

        function ZaidChat() {
            const [view, setView] = React.useState("login"); // login, create, chat
            const [room, setRoom] = React.useState(new URLSearchParams(window.location.search).get('room') || 'Ø¹Ø§Ù…Ø©');
            const [name, setName] = React.useState("");
            const [pass, setPass] = React.useState("");
            const [msgs, setMsgs] = React.useState([]);
            const [val, setVal] = React.useState("");
            const [typer, setTyper] = React.useState("");
            const [pid, setPid] = React.useState("");
            const [myStr, setMyStr] = React.useState(null);
            const [remStr, setRemStr] = React.useState(null);
            
            const pInst = React.useRef(null);
            const endRef = React.useRef(null);

            React.useEffect(() => {
                const peer = new Peer();
                peer.on('open', id => setPid(id));
                peer.on('call', c => {
                    if(confirm("ğŸ“² Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø±Ø¯Ø©.. Ù‡Ù„ ØªÙ‚Ø¨Ù„ØŸ")) {
                        navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(s => {
                            setMyStr(s); c.answer(s);
                            c.on('stream', rs => setRemStr(rs));
                        });
                    }
                });
                pInst.current = peer;
            }, []);

            React.useEffect(() => {
                endRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [msgs, typer]);

            const onLogin = async () => {
                if (!name.trim()) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
                if (room !== 'Ø¹Ø§Ù…Ø©') {
                    const snap = await rtdb.ref('roomSettings/' + room).once('value');
                    const d = snap.val();
                    if (d && d.password) {
                        if (btoa(pass) !== d.password && pass !== "ZAID_ADMIN_2026") return alert("ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§Ø·Ø¦Ø©");
                    }
                }
                setView("chat");
                initLive();
            };

            const initLive = () => {
                rtdb.ref('chats/' + room).on('child_added', s => {
                    const m = s.val();
                    setMsgs(prev => [...prev, m]);
                    if (m.senderId !== pid) alertSnd.play().catch(()=>{});
                });
                rtdb.ref('typing/' + room).on('value', s => {
                    const d = s.val() || {};
                    const active = Object.entries(d).find(([id, v]) => id !== pid && v.isTyping);
                    setTyper(active ? active[1].name : "");
                });
            };

            const send = (txt, img = null) => {
                if(!txt && !img) return;
                const clock = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                rtdb.ref('chats/' + room).push({ text: txt, image: img, time: clock, senderName: name, senderId: pid });
                setVal("");
                updateTyping(false);
            };

            const updateTyping = (s) => rtdb.ref(`typing/${room}/${pid}`).set({ name, isTyping: s });

            // 1. Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ù…Ø¹ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø®Ø§ØµØ©)
            if (view === "login") return (
                <div className="flex items-center justify-center h-screen p-6">
                    <div className="glass-card p-10 rounded-[50px] w-full max-w-sm text-center">
                        <i className="fas fa-crown text-5xl text-yellow-500 mb-6"></i>
                        <h2 className="text-3xl font-black mb-1">ZAID CHAT PRO</h2>
                        <p className="text-gray-500 text-xs mb-8 uppercase tracking-widest">Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ: {room}</p>
                        <input className="w-full p-5 bg-white/5 rounded-2xl mb-4 border border-white/10 outline-none focus:border-yellow-500 text-white" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±" onChange={e=>setName(e.target.value)} />
                        {room !== 'Ø¹Ø§Ù…Ø©' && <input className="w-full p-5 bg-white/5 rounded-2xl mb-4 border border-white/10 outline-none focus:border-yellow-500 text-white" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„ØºØ±ÙØ©" onChange={e=>setPass(e.target.value)} />}
                        <button onClick={onLogin} className="w-full btn-gold p-5 rounded-2xl text-lg mb-6">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
                        
                        <button onClick={() => setView("create")} className="text-blue-400 text-sm font-bold flex items-center justify-center gap-2 w-full">
                            <i className="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø®Ø§ØµØ© Ø¬Ø¯ÙŠØ¯Ø©
                        </button>
                    </div>
                </div>
            );

            // 2. Ø´Ø§Ø´Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø®Ø§ØµØ© (Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)
            if (view === "create") return (
                <div className="flex items-center justify-center h-screen p-6">
                    <div className="glass-card p-10 rounded-[50px] w-full max-w-sm text-center">
                        <i className="fas fa-crown text-5xl text-yellow-500 mb-6"></i>
                        <h2 className="text-3xl font-black mb-1 uppercase">ZAID CHAT PRO</h2>
                        <p className="text-gray-500 text-xs mb-10">Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</p>
                        <input className="w-full p-5 bg-white/5 rounded-2xl mb-6 border border-white/10 outline-none focus:border-blue-500 text-white" 
                               placeholder="Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ© (Ù…Ø«Ù„Ø§Ù‹: ØºØ±ÙØ© Ø²ÙŠØ¯)" onChange={e=>setRoom(e.target.value)} />
                        <button onClick={() => setView("login")} className="w-full bg-blue-600 p-5 rounded-2xl font-bold text-lg mb-6 shadow-xl">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©</button>
                        <button onClick={() => setView("login")} className="text-gray-500 text-sm">Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù</button>
                    </div>
                </div>
            );

            // 3. Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Ø¨Ø´Ø±ÙŠØ© ÙÙ‚Ø·)
            return (
                <div className="flex flex-col h-screen max-w-xl mx-auto bg-[#020617] relative">
                    <div className="glass-card m-4 p-4 rounded-3xl flex justify-between items-center z-50 border border-white/10">
                        <div className="flex items-center gap-3">
                            <button onClick={()=>window.location.search=""} className="bg-red-500/20 text-red-500 w-11 h-11 rounded-2xl flex items-center justify-center"><i className="fas fa-power-off"></i></button>
                            <div>
                                <h1 className="font-bold text-sm">Ø§Ù„ØºØ±ÙØ©: {room}</h1>
                                <span className="text-[10px] text-green-500 font-bold flex items-center gap-1"><span className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={async()=>{
                                const id=prompt("Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±:");
                                if(id){
                                    const s=await navigator.mediaDevices.getUserMedia({video:true, audio:true});
                                    setMyStr(s); const c=pInst.current.call(id, s);
                                    c.on('stream', rs=>setRemStr(rs));
                                }
                            }} className="w-11 h-11 rounded-2xl bg-blue-500/20 text-blue-400 flex items-center justify-center"><i className="fas fa-video"></i></button>
                            <button onClick={()=>{navigator.clipboard.writeText(pid); alert("ØªÙ… Ù†Ø³Ø® ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ!")}} className="w-11 h-11 rounded-2xl bg-yellow-500/20 text-yellow-500 flex items-center justify-center"><i className="fas fa-fingerprint"></i></button>
                        </div>
                    </div>

                    <div className="flex-1 chat-area no-scrollbar pb-36 flex flex-col gap-4">
                        {msgs.map((m, i) => (
                            <div key={i} className={`flex flex-col ${m.senderId === pid ? "items-end" : "items-start"}`}>
                                <span className="text-[10px] font-bold text-gray-500 mb-1 px-1 uppercase">{m.senderName}</span>
                                <div className={`msg ${m.senderId === pid ? "msg-me" : "msg-other"}`}>
                                    {m.text && <p className="text-[16px] leading-relaxed">{m.text}</p>}
                                    {m.image && <img src={m.image} className="rounded-xl mt-2 max-h-72 w-full object-cover shadow-lg" />}
                                    <span className="text-[8px] opacity-40 block mt-2 text-left">{m.time}</span>
                                </div>
                            </div>
                        ))}
                        {typer && (
                            <div className="typing-tag">
                                <span className="text-[11px] font-bold text-yellow-500">{typer} ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†</span>
                                <div className="flex gap-1 mt-1 ml-1"><span className="dot"></span><span className="dot"></span><span className="dot"></span></div>
                            </div>
                        )}
                        <div ref={endRef} />
                    </div>

                    {remStr && (
                        <div className="call-ui">
                            <video ref={el=>el&&(el.srcObject=remStr)} autoPlay className="remote-v" />
                            {myStr && <video ref={el=>el&&(el.srcObject=myStr)} autoPlay muted className="local-v" />}
                            <div className="absolute bottom-12 left-1/2 -translate-x-1/2">
                                <button onClick={()=>{myStr?.getTracks().forEach(t=>t.stop()); setMyStr(null); setRemStr(null)}} className="w-20 h-20 bg-red-600 rounded-full flex items-center justify-center shadow-3xl animate-pulse"><i className="fas fa-phone-slash text-3xl"></i></button>
                            </div>
                        </div>
                    )}

                    <div className="fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-dark to-transparent">
                        <div className="max-w-xl mx-auto flex gap-4 items-center">
                            <div className="glass-card flex-1 flex items-center rounded-[25px] px-5 border border-white/10 shadow-2xl">
                                <button onClick={()=>document.getElementById('cam').click()} className="text-yellow-500 text-xl"><i className="fas fa-camera"></i></button>
                                <input type="file" id="cam" hidden accept="image/*" onChange={e=>{
                                    const r=new FileReader(); r.onload=ev=>send(null, ev.target.result); r.readAsDataURL(e.target.files[0]);
                                }} />
                                <input className="flex-1 bg-transparent py-6 outline-none text-white text-[15px] px-4" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ù…Ù„ÙƒÙŠØ©..." value={val} 
                                       onChange={e=>{setVal(e.target.value); updateTyping(e.target.value.length>0)}} 
                                       onBlur={()=>updateTyping(false)} onKeyPress={e=>e.key==='Enter'&&send(val)} />
                            </div>
                            <button onClick={()=>send(val)} className="send-btn"><i className="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<ZaidChat />);
    </script>
</body>
</html>